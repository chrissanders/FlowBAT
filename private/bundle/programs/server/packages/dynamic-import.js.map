{"version":3,"sources":["meteor://ðŸ’»app/packages/dynamic-import/server.js","meteor://ðŸ’»app/packages/dynamic-import/cache.js","meteor://ðŸ’»app/packages/dynamic-import/client.js","meteor://ðŸ’»app/packages/dynamic-import/dynamic-versions.js","meteor://ðŸ’»app/packages/dynamic-import/security.js"],"names":["module1","module","assert","watch","require","default","v","readFileSync","pathJoin","pathNormalize","join","normalize","check","hasOwn","Object","prototype","hasOwnProperty","keys","dynamicImportInfo","forEach","platform","info","dynamicRoot","Meteor","methods","__dynamicImport","tree","unblock","connection","pathParts","walk","node","name","push","strictEqual","pop","read","absPath","replace","startsWith","Error","cache","getCache","call","cachesByPlatform","create","process","on","msg","refresh","dbPromise","canUseCache","isClient","isCordova","isProduction","getIDB","indexedDB","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB","withDB","callback","Promise","resolve","reject","idb","request","open","onupgradeneeded","event","db","target","result","Array","from","objectStoreNames","deleteObjectStore","objectStoreMap","createObjectStore","onerror","makeOnError","onsuccess","then","error","sourcesByVersion","keyPath","source","JSON","stringify","checkCount","exports","checkMany","versions","ids","sourcesById","id","txn","transaction","objectStore","finish","all","map","version","sourceRequest","get","pendingVersionsAndSourcesById","setMany","versionsAndSourcesById","assign","flushSetMany","timer","setTimeout","setTxn","put","Module","constructor","dynamicImport","prefetch","getNamespace","meteorInstall","fetch","dynamicVersions","missing","addSource","addToTree","makeModuleFunction","options","addMissing","sources","fetchMissing","results","flatResults","flattenModuleTree","parts","t","key","eval","apply","arguments","missingTree","resultsTree","value","split","lastIndex","length","part","i","namespace","ns","defineProperty","enumerable","__DYNAMIC_VERSIONS__","some","bpc","Package","BP","BrowserPolicy","BPc","content","allowEval"],"mappings":"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","file":"/packages/dynamic-import.js","sourcesContent":["import assert from \"assert\";\nimport { readFileSync } from \"fs\";\nimport {\n  join as pathJoin,\n  normalize as pathNormalize,\n} from \"path\";\n\nimport { check } from \"meteor/check\";\n\nimport \"./security.js\";\nimport \"./client.js\";\n\nconst hasOwn = Object.prototype.hasOwnProperty;\n\nObject.keys(dynamicImportInfo).forEach(platform => {\n  const info = dynamicImportInfo[platform];\n  if (info.dynamicRoot) {\n    info.dynamicRoot = pathNormalize(info.dynamicRoot);\n  }\n});\n\nMeteor.methods({\n  __dynamicImport(tree) {\n    check(tree, Object);\n    this.unblock();\n\n    const platform = this.connection ? \"web.browser\" : \"server\";\n    const pathParts = [];\n\n    function walk(node) {\n      if (node && typeof node === \"object\") {\n        Object.keys(node).forEach(name => {\n          pathParts.push(name);\n          node[name] = walk(node[name]);\n          assert.strictEqual(pathParts.pop(), name);\n        });\n      } else {\n        return read(pathParts, platform);\n      }\n      return node;\n    }\n\n    return walk(tree);\n  }\n});\n\nfunction read(pathParts, platform) {\n  const { dynamicRoot } = dynamicImportInfo[platform];\n  const absPath = pathNormalize(pathJoin(\n    dynamicRoot,\n    pathJoin(...pathParts).replace(/:/g, \"_\")\n  ));\n\n  if (! absPath.startsWith(dynamicRoot)) {\n    throw new Meteor.Error(\"bad dynamic module path\");\n  }\n\n  const cache = getCache(platform);\n  return hasOwn.call(cache, absPath)\n    ? cache[absPath]\n    : cache[absPath] = readFileSync(absPath, \"utf8\");\n}\n\nconst cachesByPlatform = Object.create(null);\nfunction getCache(platform) {\n  return hasOwn.call(cachesByPlatform, platform)\n    ? cachesByPlatform[platform]\n    : cachesByPlatform[platform] = Object.create(null);\n}\n\nprocess.on(\"message\", msg => {\n  // The cache for the \"web.browser\" platform needs to be discarded\n  // whenever a client-only refresh occurs, so that new client code does\n  // not receive stale module data from __dynamicImport. This code handles\n  // the same message listened for by the autoupdate package.\n  if (msg && msg.refresh === \"client\") {\n    delete cachesByPlatform[\"web.browser\"];\n  }\n});\n","var hasOwn = Object.prototype.hasOwnProperty;\nvar dbPromise;\n\nvar canUseCache =\n  // The server doesn't benefit from dynamic module fetching, and almost\n  // certainly doesn't support IndexedDB.\n  Meteor.isClient &&\n  // Cordova bundles all modules into the monolithic initial bundle, so\n  // the dynamic module cache won't be necessary.\n  ! Meteor.isCordova &&\n  // Caching can be confusing in development, and is designed to be a\n  // transparent optimization for production performance.\n  Meteor.isProduction;\n\nfunction getIDB() {\n  if (typeof indexedDB !== \"undefined\") return indexedDB;\n  if (typeof webkitIndexedDB !== \"undefined\") return webkitIndexedDB;\n  if (typeof mozIndexedDB !== \"undefined\") return mozIndexedDB;\n  if (typeof OIndexedDB !== \"undefined\") return OIndexedDB;\n  if (typeof msIndexedDB !== \"undefined\") return msIndexedDB;\n}\n\nfunction withDB(callback) {\n  dbPromise = dbPromise || new Promise(function (resolve, reject) {\n    var idb = getIDB();\n    if (! idb) {\n      throw new Error(\"IndexedDB not available\");\n    }\n\n    // Incrementing the version number causes all existing object stores\n    // to be deleted and recreates those specified by objectStoreMap.\n    var request = idb.open(\"MeteorDynamicImportCache\", 2);\n\n    request.onupgradeneeded = function (event) {\n      var db = event.target.result;\n\n      // It's fine to delete existing object stores since onupgradeneeded\n      // is only called when we change the DB version number, and the data\n      // we're storing is disposable/reconstructible.\n      Array.from(db.objectStoreNames).forEach(db.deleteObjectStore, db);\n\n      Object.keys(objectStoreMap).forEach(function (name) {\n        db.createObjectStore(name, objectStoreMap[name]);\n      });\n    };\n\n    request.onerror = makeOnError(reject, \"indexedDB.open\");\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n\n  return dbPromise.then(callback, function (error) {\n    return callback(null);\n  });\n}\n\nvar objectStoreMap = {\n  sourcesByVersion: { keyPath: \"version\" }\n};\n\nfunction makeOnError(reject, source) {\n  return function (event) {\n    reject(new Error(\n      \"IndexedDB failure in \" + source + \" \" +\n        JSON.stringify(event.target)\n    ));\n\n    // Returning true from an onerror callback function prevents an\n    // InvalidStateError in Firefox during Private Browsing. Silencing\n    // that error is safe because we handle the error more gracefully by\n    // passing it to the Promise reject function above.\n    // https://github.com/meteor/meteor/issues/8697\n    return true;\n  };\n}\n\nvar checkCount = 0;\n\nexports.checkMany = function (versions) {\n  var ids = Object.keys(versions);\n  var sourcesById = Object.create(null);\n\n  // Initialize sourcesById with null values to indicate all sources are\n  // missing (unless replaced with actual sources below).\n  ids.forEach(function (id) {\n    sourcesById[id] = null;\n  });\n\n  if (! canUseCache) {\n    return Promise.resolve(sourcesById);\n  }\n\n  return withDB(function (db) {\n    if (! db) {\n      // We thought we could used IndexedDB, but something went wrong\n      // while opening the database, so err on the side of safety.\n      return sourcesById;\n    }\n\n    var txn = db.transaction([\n      \"sourcesByVersion\"\n    ], \"readonly\");\n\n    var sourcesByVersion = txn.objectStore(\"sourcesByVersion\");\n\n    ++checkCount;\n\n    function finish() {\n      --checkCount;\n      return sourcesById;\n    }\n\n    return Promise.all(ids.map(function (id) {\n      return new Promise(function (resolve, reject) {\n        var version = versions[id];\n        if (version) {\n          var sourceRequest = sourcesByVersion.get(version);\n          sourceRequest.onerror = makeOnError(reject, \"sourcesByVersion.get\");\n          sourceRequest.onsuccess = function (event) {\n            var result = event.target.result;\n            if (result) {\n              sourcesById[id] = result.source;\n            }\n            resolve();\n          };\n        } else resolve();\n      });\n    })).then(finish, finish);\n  });\n};\n\nvar pendingVersionsAndSourcesById = Object.create(null);\n\nexports.setMany = function (versionsAndSourcesById) {\n  if (canUseCache) {\n    Object.assign(\n      pendingVersionsAndSourcesById,\n      versionsAndSourcesById\n    );\n\n    // Delay the call to flushSetMany so that it doesn't contribute to the\n    // amount of time it takes to call module.dynamicImport.\n    if (! flushSetMany.timer) {\n      flushSetMany.timer = setTimeout(flushSetMany, 100);\n    }\n  }\n};\n\nfunction flushSetMany() {\n  if (checkCount > 0) {\n    // If checkMany is currently underway, postpone the flush until later,\n    // since updating the cache is less important than reading from it.\n    return flushSetMany.timer = setTimeout(flushSetMany, 100);\n  }\n\n  flushSetMany.timer = null;\n\n  var versionsAndSourcesById = pendingVersionsAndSourcesById;\n  pendingVersionsAndSourcesById = Object.create(null);\n\n  return withDB(function (db) {\n    if (! db) {\n      // We thought we could used IndexedDB, but something went wrong\n      // while opening the database, so err on the side of safety.\n      return;\n    }\n\n    var setTxn = db.transaction([\n      \"sourcesByVersion\"\n    ], \"readwrite\");\n\n    var sourcesByVersion = setTxn.objectStore(\"sourcesByVersion\");\n\n    return Promise.all(\n      Object.keys(versionsAndSourcesById).map(function (id) {\n        var info = versionsAndSourcesById[id];\n        return new Promise(function (resolve, reject) {\n          var request = sourcesByVersion.put({\n            version: info.version,\n            source: info.source\n          });\n          request.onerror = makeOnError(reject, \"sourcesByVersion.put\");\n          request.onsuccess = resolve;\n        });\n      })\n    );\n  });\n}\n","var Module = module.constructor;\nvar cache = require(\"./cache.js\");\n\n// Call module.dynamicImport(id) to fetch a module and any/all of its\n// dependencies that have not already been fetched, and evaluate them as\n// soon as they arrive. This runtime API makes it very easy to implement\n// ECMAScript dynamic import(...) syntax.\nModule.prototype.dynamicImport = function (id) {\n  var module = this;\n  return module.prefetch(id).then(function () {\n    return getNamespace(module, id);\n  });\n};\n\n// Called by Module.prototype.prefetch if there are any missing dynamic\n// modules that need to be fetched.\nmeteorInstall.fetch = function (ids) {\n  var tree = Object.create(null);\n  var versions = Object.create(null);\n  var dynamicVersions = require(\"./dynamic-versions.js\");\n  var missing;\n\n  function addSource(id, source) {\n    addToTree(tree, id, makeModuleFunction(id, source, ids[id].options));\n  }\n\n  function addMissing(id) {\n    addToTree(missing = missing || Object.create(null), id, 1);\n  }\n\n  Object.keys(ids).forEach(function (id) {\n    var version = dynamicVersions.get(id);\n    if (version) {\n      versions[id] = version;\n    } else {\n      addMissing(id);\n    }\n  });\n\n  return cache.checkMany(versions).then(function (sources) {\n    Object.keys(sources).forEach(function (id) {\n      var source = sources[id];\n      if (source) {\n        addSource(id, source);\n      } else {\n        addMissing(id);\n      }\n    });\n\n    return missing && fetchMissing(missing).then(function (results) {\n      var versionsAndSourcesById = Object.create(null);\n      var flatResults = flattenModuleTree(results);\n\n      Object.keys(flatResults).forEach(function (id) {\n        var source = flatResults[id];\n        addSource(id, source);\n\n        var version = dynamicVersions.get(id);\n        if (version) {\n          versionsAndSourcesById[id] = {\n            version: version,\n            source: source\n          };\n        }\n      });\n\n      cache.setMany(versionsAndSourcesById);\n    });\n\n  }).then(function () {\n    return tree;\n  });\n};\n\nfunction flattenModuleTree(tree) {\n  var parts = [\"\"];\n  var result = Object.create(null);\n\n  function walk(t) {\n    if (t && typeof t === \"object\") {\n      Object.keys(t).forEach(function (key) {\n        parts.push(key);\n        walk(t[key]);\n        parts.pop();\n      });\n    } else if (typeof t === \"string\") {\n      result[parts.join(\"/\")] = t;\n    }\n  }\n\n  walk(tree);\n\n  return result;\n}\n\nfunction makeModuleFunction(id, source, options) {\n  // By calling (options && options.eval || eval) in a wrapper function,\n  // we delay the cost of parsing and evaluating the module code until the\n  // module is first imported.\n  return function () {\n    // If an options.eval function was provided in the second argument to\n    // meteorInstall when this bundle was first installed, use that\n    // function to parse and evaluate the dynamic module code in the scope\n    // of the package. Otherwise fall back to indirect (global) eval.\n    return (options && options.eval || eval)(\n      // Wrap the function(require,exports,module){...} expression in\n      // parentheses to force it to be parsed as an expression.\n      \"(\" + source + \")\\n//# sourceURL=\" + id\n    ).apply(this, arguments);\n  };\n}\n\nfunction fetchMissing(missingTree) {\n  // Update lastFetchMissingPromise immediately, without waiting for\n  // the results to be delivered.\n  return new Promise(function (resolve, reject) {\n    Meteor.call(\n      \"__dynamicImport\",\n      missingTree,\n      function (error, resultsTree) {\n        error ? reject(error) : resolve(resultsTree);\n      }\n    );\n  });\n}\n\nfunction addToTree(tree, id, value) {\n  var parts = id.split(\"/\");\n  var lastIndex = parts.length - 1;\n  parts.forEach(function (part, i) {\n    if (part) {\n      tree = tree[part] = tree[part] ||\n        (i < lastIndex ? Object.create(null) : value);\n    }\n  });\n}\n\nfunction getNamespace(module, id) {\n  var namespace;\n\n  module.watch(module.require(id), {\n    \"*\": function (ns) {\n      namespace = ns;\n    }\n  });\n\n  // This helps with Babel interop, since we're not just returning the\n  // module.exports object.\n  Object.defineProperty(namespace, \"__esModule\", {\n    value: true,\n    enumerable: false\n  });\n\n  return namespace;\n}\n","// This magic double-underscored identifier gets replaced in\n// tools/isobuild/bundler.js with a tree of hashes of all dynamic\n// modules, for use in client.js and cache.js.\nvar versions = __DYNAMIC_VERSIONS__;\n\nexports.get = function (id) {\n  var tree = versions;\n  var version = null;\n\n  id.split(\"/\").some(function (part) {\n    if (part) {\n      // If the tree contains identifiers for Meteor packages with colons\n      // in their names, the colons should not have been replaced by\n      // underscores, but there's a bug that results in that behavior, so\n      // for now it seems safest to be tolerant of underscores here.\n      // https://github.com/meteor/meteor/pull/9103\n      tree = tree[part] || tree[part.replace(\":\", \"_\")];\n    }\n\n    if (! tree) {\n      // Terminate the search without reassigning version.\n      return true;\n    }\n\n    if (typeof tree === \"string\") {\n      version = tree;\n      return true;\n    }\n  });\n\n  return version;\n};\n","const bpc = Package[\"browser-policy-content\"];\nconst BP = bpc && bpc.BrowserPolicy;\nconst BPc = BP && BP.content;\nif (BPc) {\n  // The ability to evaluate new code is essential for loading dynamic\n  // modules. Without eval, we would be forced to load modules using\n  // <script src=...> tags, and then there would be no way to save those\n  // modules to a local cache (or load them from the cache) without the\n  // unique response caching abilities of service workers, which are not\n  // available in all browsers, and cannot be polyfilled in a way that\n  // satisfies Content Security Policy eval restrictions. Moreover, eval\n  // allows us to evaluate dynamic module code in the original package\n  // scope, which would never be possible using <script> tags. If you're\n  // deploying an app in an environment that demands a Content Security\n  // Policy that forbids eval, your only option is to bundle all dynamic\n  // modules in the initial bundle. Fortunately, that works perfectly\n  // well; you just won't get the performance benefits of dynamic module\n  // fetching.\n  BPc.allowEval();\n}\n"]}